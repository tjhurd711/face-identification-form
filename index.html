<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition - Birth Years</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #007bff;
            min-height: 100vh;
        }
        .container {
            background: #ede7d4;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            color: #63462f;
        }
        h1 {
            text-align: center;
            color: #63462f;
            margin-bottom: 30px;
        }
        .notice-box {
            background-color: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        .notice-box h2 {
            color: #856404;
            margin: 0 0 10px 0;
            font-size: 20px;
        }
        .notice-box p {
            color: #856404;
            margin: 0;
            font-size: 16px;
            font-weight: bold;
        }
        .face-container {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #63462f;
            border-radius: 8px;
            text-align: center;
            background: rgba(237, 231, 212, 0.9);
        }
        .face-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .face-label {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #63462f;
        }
        .input-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .checkbox-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 180px;
            padding: 15px;
            background-color: #ffeaa7;
            border-radius: 10px;
            border: 2px solid #fdcb6e;
        }
        .skin-tone-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 180px;
            padding: 15px;
            background-color: #dda0dd;
            border-radius: 10px;
            border: 2px solid #ba68c8;
        }
        .unsure-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 180px;
            padding: 15px;
            background-color: #b3e5fc;
            border-radius: 10px;
            border: 2px solid #81d4fa;
        }
        .birth-year-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .birth-year-input {
            width: 120px;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #63462f;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 8px;
            background: white;
            color: #63462f;
        }
        .birth-year-input:focus {
            border-color: #72bcff;
            outline: none;
        }
        .birth-year-input:disabled {
            background-color: #f5f5f5;
            color: #999;
        }
        .checkbox-label {
            display: flex;
            align-items: flex-start;
            text-align: center;
            font-size: 16px;
            line-height: 1.4;
            margin-bottom: 10px;
            max-width: 160px;
        }
        .checkbox-label input[type="checkbox"] {
            margin-right: 8px;
            margin-top: 3px;
            flex-shrink: 0;
        }
        .radio-label {
            display: flex;
            align-items: center;
            text-align: left;
            font-size: 16px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        .radio-label input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
        }
        .deceased-checkbox {
            color: #8b4513;
            font-weight: bold;
        }
        .unsure-checkbox {
            color: #2c5282;
            font-weight: bold;
        }
        .skin-tone-label {
            color: #663399;
            font-weight: bold;
            margin-bottom: 12px;
            text-align: center;
            font-size: 16px;
        }
        .submit-btn {
            background-color: #007bff;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }
        .submit-btn:hover {
            background-color: #0056b3;
        }
        .error {
            color: red;
            font-size: 14px;
            margin-top: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .image-overlay {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        .face-box {
            position: absolute;
            border: 3px solid #007bff;
            border-radius: 5px;
            background: rgba(0, 123, 255, 0.1);
            pointer-events: none;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }
        .modal-content {
            position: relative;
            margin: auto;
            padding: 20px;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        .modal img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
        }
        .close:hover {
            opacity: 0.7;
        }
        .click-hint {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }
        .deceased-reminder {
            background-color: #ffe0b2;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 16px;
            color: #e65100;
            font-weight: bold;
        }
        .submit-error {
            background-color: #ffebee;
            border: 2px solid #f44336;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            color: #c62828;
            text-align: center;
            font-weight: bold;
        }
        @media (max-width: 600px) {
            .input-section {
                flex-direction: column;
                gap: 15px;
            }
            .checkbox-section, .skin-tone-section, .unsure-section {
                min-width: auto;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MemorialVideo.AI - Family Photo Face Recognition</h1>
        
        <div class="notice-box">
            <h2>Important Notice</h2>
            <p>If the same person is shown in the form twice, that's perfectly normal. Just fill in the same birth year again.</p>
        </div>
        
        <p style="text-align: center; color: #666;">Please provide the birth year for each detected face:</p>
        
        <div id="faces-container">
            <div class="loading">Loading faces...</div>
        </div>

        <!-- Reminder when deceased person is not checked -->
        <div id="deceased-reminder" class="deceased-reminder" style="display: none;">
            Remember to check the <strong>"Check this box if this is the person who has passed"</strong> on the person who has passed
        </div>

        <button class="submit-btn" onclick="submitForm()">Submit</button>
        
        <!-- Error message for submit without deceased selection -->
        <div id="submit-error" class="submit-error" style="display: none;">
            Please mark which person has passed before submitting
        </div>
        
        <div id="result"></div>
    </div>

    <!-- Modal for enlarged images -->
    <div id="imageModal" class="modal" onclick="closeModal()">
        <span class="close" onclick="closeModal()">&times;</span>
        <div class="modal-content">
            <img id="modalImg" src="">
        </div>
    </div>

    <script>
    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        const results = regex.exec(location.search);
        const value = results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        return value;
    }

    function handleUnsureChange(faceIndex) {
        const unsureCheckbox = document.getElementById(`face${faceIndex}_unsure`);
        const birthYearInput = document.getElementById(`face${faceIndex}_year`);
        const errorDiv = document.getElementById(`face${faceIndex}_error`);
        
        if (unsureCheckbox.checked) {
            birthYearInput.disabled = true;
            birthYearInput.value = '';
            errorDiv.textContent = '';
        } else {
            birthYearInput.disabled = false;
        }
    }

    // Validation functions
    function validateDeceasedBirthYears() {
        const faceCount = parseInt(getUrlParameter('face_count')) || 0;
        const deceasedFaces = [];
        const deceasedBirthYears = [];
        
        // Collect all deceased faces and their birth years
        for (let i = 1; i <= faceCount; i++) {
            const deceasedCheckbox = document.getElementById(`face${i}_deceased`);
            const birthYearInput = document.getElementById(`face${i}_year`);
            const unsureCheckbox = document.getElementById(`face${i}_unsure`);
            
            if (deceasedCheckbox && deceasedCheckbox.checked) {
                deceasedFaces.push(i);
                
                // Only check birth year if not marked as unsure
                if (!unsureCheckbox.checked && birthYearInput && birthYearInput.value) {
                    const birthYear = parseInt(birthYearInput.value);
                    if (birthYear >= 1900 && birthYear <= 2026) {
                        deceasedBirthYears.push({
                            faceIndex: i,
                            birthYear: birthYear
                        });
                    }
                }
            }
        }
        
        // Check for conflicts only if we have multiple deceased faces with birth years
        if (deceasedFaces.length > 1 && deceasedBirthYears.length > 1) {
            const uniqueBirthYears = [...new Set(deceasedBirthYears.map(item => item.birthYear))];
            
            if (uniqueBirthYears.length > 1) {
                // Conflict detected!
                const conflictMessage = deceasedBirthYears.map(item => 
                    `Person ${item.faceIndex}: ${item.birthYear}`
                ).join('\n');
                
                alert(`⚠️ Birth Year Conflict Detected!\n\nYou marked multiple people as deceased but gave them different birth years:\n\n${conflictMessage}\n\nSince these represent the same person at different ages, they should have the same birth year. Please correct this before submitting.`);
                
                // Highlight the conflicting inputs
                deceasedBirthYears.forEach(item => {
                    const input = document.getElementById(`face${item.faceIndex}_year`);
                    if (input) {
                        input.style.border = '3px solid red';
                        input.style.backgroundColor = '#ffe6e6';
                    }
                });
                
                return false; // Prevent submission
            }
        }
        
        // Clear any previous conflict highlighting
        for (let i = 1; i <= faceCount; i++) {
            const input = document.getElementById(`face${i}_year`);
            if (input) {
                input.style.border = '';
                input.style.backgroundColor = '';
            }
        }
        
        return true; // Validation passed
    }

    function setupDeceasedValidation() {
        const faceCount = parseInt(getUrlParameter('face_count')) || 0;
        
        for (let i = 1; i <= faceCount; i++) {
            const deceasedCheckbox = document.getElementById(`face${i}_deceased`);
            const birthYearInput = document.getElementById(`face${i}_year`);
            
            if (deceasedCheckbox) {
                deceasedCheckbox.addEventListener('change', () => {
                    setTimeout(validateDeceasedBirthYears, 100);
                });
            }
            
            if (birthYearInput) {
                birthYearInput.addEventListener('input', () => {
                    setTimeout(validateDeceasedBirthYears, 100);
                });
            }
        }
    }

    function syncDeceasedBirthYears(changedFaceIndex) {
        const faceCount = parseInt(getUrlParameter('face_count')) || 0;
        const changedInput = document.getElementById(`face${changedFaceIndex}_year`);
        const changedCheckbox = document.getElementById(`face${changedFaceIndex}_deceased`);
        const changedUnsure = document.getElementById(`face${changedFaceIndex}_unsure`);
        
        // Only sync if this face is deceased, not unsure, and has a valid birth year
        if (!changedCheckbox.checked || changedUnsure.checked || !changedInput.value) {
            return;
        }
        
        const newBirthYear = parseInt(changedInput.value);
        if (newBirthYear < 1900 || newBirthYear > 2026) {
            return;
        }
        
        // Find all other deceased faces and update their birth years
        let syncedCount = 0;
        for (let i = 1; i <= faceCount; i++) {
            if (i === changedFaceIndex) continue;
            
            const otherCheckbox = document.getElementById(`face${i}_deceased`);
            const otherInput = document.getElementById(`face${i}_year`);
            const otherUnsure = document.getElementById(`face${i}_unsure`);
            
            if (otherCheckbox && otherCheckbox.checked && !otherUnsure.checked) {
                const currentValue = parseInt(otherInput.value) || 0;
                
                // Only update if it's empty or different
                if (!otherInput.value || currentValue !== newBirthYear) {
                    otherInput.value = newBirthYear;
                    otherInput.style.border = '2px solid green';
                    otherInput.style.backgroundColor = '#e6ffe6';
                    syncedCount++;
                    
                    // Clear the highlighting after a moment
                    setTimeout(() => {
                        otherInput.style.border = '';
                        otherInput.style.backgroundColor = '';
                    }, 2000);
                }
            }
        }
        
        if (syncedCount > 0) {
            // Show a brief confirmation
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                z-index: 1000;
                font-weight: bold;
            `;
            message.textContent = `✓ Synced birth year to ${syncedCount} other deceased face(s)`;
            document.body.appendChild(message);
            
            setTimeout(() => {
                document.body.removeChild(message);
            }, 3000);
        }
    }

    function setupBirthYearSync() {
        const faceCount = parseInt(getUrlParameter('face_count')) || 0;
        
        for (let i = 1; i <= faceCount; i++) {
            const birthYearInput = document.getElementById(`face${i}_year`);
            
            if (birthYearInput) {
                birthYearInput.addEventListener('blur', () => {
                    syncDeceasedBirthYears(i);
                });
            }
        }
    }

    function showDirectImage(imageUrl, bbox, faceIndex, roll) {
        return new Promise((resolve) => {
            const img = new Image();
            
            img.onload = function() {
                // Calculate face box position
                const imgWidth = 300; // Display width
                const imgHeight = (img.naturalHeight / img.naturalWidth) * imgWidth;
                
                // Images are already properly oriented by Lambda's ImageOps.exif_transpose()
                // No CSS rotation needed - just use bbox coordinates directly
                const faceBox = {
                    left: bbox.left * imgWidth,
                    top: bbox.top * imgHeight,
                    width: bbox.width * imgWidth,
                    height: bbox.height * imgHeight
                };
                
                console.log(`Face ${faceIndex}: Using pre-corrected image, bbox=`, faceBox);
                
                const imageHtml = `
                    <div class="image-overlay" onclick="openModal('${imageUrl}'); return false;">
                        <img src="${imageUrl}" alt="Full Image ${faceIndex}" 
                               style="max-width: 300px; height: auto;"
                               onclick="openModal('${imageUrl}'); return false;">
                        <div class="face-box" style="
                            left: ${faceBox.left}px; 
                            top: ${faceBox.top}px; 
                            width: ${faceBox.width}px; 
                            height: ${faceBox.height}px;
                            pointer-events: none;
                        "></div>
                    </div>
                    <div class="click-hint">
                        Click image to enlarge
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 3px;">
                        Blue box shows detected face area
                    </div>
                `;
                
                resolve(imageHtml);
            };
            
            img.onerror = function() {
                resolve(`<div style="color: red;">Failed to load image</div>`);
            };
            
            img.src = imageUrl;
        });
    }

    // Window load handler
    window.addEventListener('load', function() {
        loadFaces();
        
        // Set up validation after faces are loaded
        setTimeout(() => {
            setupDeceasedValidation();
            setupBirthYearSync();
            updateDeceasedReminder();
        }, 2000);
    });

    async function loadFaces() {
        const faceCount = parseInt(getUrlParameter('face_count')) || 0;
        const orderId = getUrlParameter('order_id') || '';
        
        if (faceCount === 0) {
            document.getElementById('faces-container').innerHTML = 
                '<div style="text-align: center; color: #999;">No faces provided. This appears to be a demo page.</div>';
            return;
        }
        
        let facesHtml = '';
        
        for (let i = 1; i <= faceCount; i++) {
            facesHtml += `
                <div class="face-container" id="face-container-${i}">
                    <div class="face-label">Person ${i}</div>
                    <div class="loading">Loading face image...</div>
                </div>
            `;
        }
        
        document.getElementById('faces-container').innerHTML = facesHtml;
        
        // Load faces one by one
        for (let i = 1; i <= faceCount; i++) {
            const faceUrl = getUrlParameter('face' + i + '_url');
            const left = parseFloat(getUrlParameter('face' + i + '_left')) || 0;
            const top = parseFloat(getUrlParameter('face' + i + '_top')) || 0;
            const width = parseFloat(getUrlParameter('face' + i + '_width')) || 1;
            const height = parseFloat(getUrlParameter('face' + i + '_height')) || 1;
            const roll = parseFloat(getUrlParameter('face' + i + '_roll')) || 0;
            
            if (faceUrl) {
                const bbox = { left, top, width, height };
                
                try {
                    const imageHtml = await showDirectImage(faceUrl, bbox, i, roll);
                    const container = document.getElementById('face-container-' + i);
                    
                    container.innerHTML = `
                        <div class="face-label">Familiar Face ${i}</div>
                        ${imageHtml}
                        
                        <div class="input-section">
                            <div class="checkbox-section">
                                <label class="checkbox-label deceased-checkbox">
                                    <input type="checkbox" id="face${i}_deceased" onchange="updateDeceasedReminder()">
                                    Check this box if this is the person who has passed
                                </label>
                            </div>
                            
                            <div class="skin-tone-section">
                                <label class="skin-tone-label">
                                    Skin tone for age estimation:
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="face${i}_skin_tone" value="light" checked>
                                    Light skin (Caucasian)
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="face${i}_skin_tone" value="dark">
                                    Medium/Darker skin (all others)
                                </label>
                            </div>
                            
                            <div class="unsure-section">
                                <label class="checkbox-label unsure-checkbox">
                                    <input type="checkbox" id="face${i}_unsure" onchange="handleUnsureChange(${i})">
                                    Select this box if you aren't sure of the birth year
                                </label>
                            </div>
                        </div>
                        
                        <div class="birth-year-section" style="margin-top: 20px;">
                            <label style="font-weight: bold; margin-bottom: 8px;">
                                Enter Birth Year (at least within 3 years):
                            </label>
                            <input type="number" class="birth-year-input" 
                                    id="face${i}_year" 
                                    min="1900" max="2026" 
                                    placeholder="e.g. 1985">
                            <div class="error" id="face${i}_error"></div>
                        </div>
                    `;
                    
                } catch (error) {
                    const container = document.getElementById('face-container-' + i);
                    container.innerHTML = `
                        <div class="face-label">Face ${i}</div>
                        <div style="color: red; padding: 10px;">
                            Error loading face image
                        </div>
                    `;
                }
            } else {
                const container = document.getElementById('face-container-' + i);
                container.innerHTML = `
                    <div class="face-label">Face ${i}</div>
                    <div style="color: red; padding: 10px;">
                        No image URL provided for this face
                    </div>
                `;
            }
        }
        
        // Initialize the deceased reminder visibility after loading
        setTimeout(() => {
            updateDeceasedReminder();
        }, 1000);
    }

    function updateDeceasedReminder() {
        const faceCount = parseInt(getUrlParameter('face_count')) || 0;
        let anyDeceasedChecked = false;

        // Check if any deceased checkbox is checked
        for (let i = 1; i <= faceCount; i++) {
            const deceasedCheckbox = document.getElementById(`face${i}_deceased`);
            if (deceasedCheckbox && deceasedCheckbox.checked) {
                anyDeceasedChecked = true;
                break;
            }
        }

        // Show reminder only if no deceased boxes are checked
        const reminder = document.getElementById('deceased-reminder');
        if (reminder) {
            reminder.style.display = anyDeceasedChecked ? 'none' : 'block';
        }

        // Hide submit error when a deceased checkbox is checked
        if (anyDeceasedChecked) {
            const submitError = document.getElementById('submit-error');
            if (submitError) {
                submitError.style.display = 'none';
            }
        }
    }

    function openModal(imageUrl) {
        try {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImg');
            if (modal && modalImg) {
                modal.style.display = 'block';
                modalImg.src = imageUrl;
            }
        } catch (error) {
            console.error('Error opening modal:', error);
        }
    }

    function closeModal() {
        try {
            const modal = document.getElementById('imageModal');
            if (modal) {
                modal.style.display = 'none';
            }
        } catch (error) {
            console.error('Error closing modal:', error);
        }
    }

    async function submitForm() {
        // Validate deceased birth years first
        if (!validateDeceasedBirthYears()) {
            return; // Stop submission if validation fails
        }
        
        // Clear previous errors
        document.querySelectorAll('.error').forEach(el => el.textContent = '');
        const submitError = document.getElementById('submit-error');
        submitError.style.display = 'none';
        
        const faceCount = parseInt(getUrlParameter('face_count')) || 0;
        const orderId = getUrlParameter('order_id') || '';
        
        const birthYears = {};
        const deceasedFaces = [];
        const unsureFaces = [];
        const skinTones = {};
        let hasErrors = false;
        
        for (let i = 1; i <= faceCount; i++) {
            const yearInput = document.getElementById('face' + i + '_year');
            const deceasedCheckbox = document.getElementById('face' + i + '_deceased');
            const unsureCheckbox = document.getElementById('face' + i + '_unsure');
            const skinToneRadio = document.querySelector(`input[name="face${i}_skin_tone"]:checked`);
            const error = document.getElementById('face' + i + '_error');
        
            if (yearInput && deceasedCheckbox && unsureCheckbox && error) {
                if (deceasedCheckbox.checked) {
                    deceasedFaces.push(`person_${i}`);
                }
                
                // Collect skin tone selection
                if (skinToneRadio) {
                    skinTones[`person_${i}`] = skinToneRadio.value; // "light" or "dark"
                }
        
                if (unsureCheckbox.checked) {
                    unsureFaces.push(`person_${i}`);
                } else {
                    const year = parseInt(yearInput.value);
                    if (!year || year < 1900 || year > 2026) {
                        error.textContent = 'Please enter a valid birth year (1900-2026) or check "unsure"';
                        hasErrors = true;
                    } else {
                        birthYears[`person_${i}`] = year;
                    }
                }
            }
        }
        
        // Check if no deceased person was marked
        if (deceasedFaces.length === 0) {
            submitError.style.display = 'block';
            return;
        }
        
        // Confirm if multiple deceased faces marked
        if (deceasedFaces.length > 1) {
            if (!confirm(`You marked ${deceasedFaces.length} faces as the deceased person. This likely means the same person appears in multiple age ranges. We'll merge these together. Continue?`)) {
                return;
            }
        }
        
        if (hasErrors) {
            return;
        }
        
        const submissionData = {
            order_id: orderId,
            birth_years: birthYears,
            deceased_faces: deceasedFaces,
            unsure_faces: unsureFaces,
            skin_tones: skinTones,
            submitted_at: new Date().toISOString(),
            face_count: faceCount
        };

        submitToS3(submissionData);
    }

    async function submitToS3(data) {
        document.getElementById('result').innerHTML = '<div class="loading">Submitting your responses...</div>';
        
        try {
            const orderId = data.order_id;
        
            // Upload form data to existing location  
            const formDataKey = `ff-analysis/${orderId}/form_submission.json`;
            const formDataUrl = `https://order-by-age-uploads.s3.amazonaws.com/${formDataKey}`;
        
            await fetch(formDataUrl, {
                method: 'PUT',
                headers: { 
                    'Content-Type': 'application/json',
                    'x-amz-acl': 'bucket-owner-full-control'
                },
                body: JSON.stringify(data)
            });
        
            // Create completion flag in new trigger location
            const completionKey = `form-handler/${orderId}/form.complete`;
            const completionUrl = `https://order-by-age-uploads.s3.amazonaws.com/${completionKey}`;
        
            await fetch(completionUrl, {
                method: 'PUT',
                headers: { 
                    'Content-Type': 'application/json',
                    'x-amz-acl': 'bucket-owner-full-control'
                },
                body: JSON.stringify({
                    completed_at: new Date().toISOString(),
                    deceased_person_identified: data.deceased_faces.length > 0
                })
            });
        
            document.getElementById('result').innerHTML = `
                <div class="success">
                    <h3>Thank you!</h3>
                    <p>Your responses have been submitted successfully.</p>
                </div>
            `;
        
        } catch (error) {
            document.getElementById('result').innerHTML = `
                <div style="background-color: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px;">
                    <h3>Submission Error</h3>
                    <p>Please try again. Error: ${error.message}</p>
                </div>
            `;
        }
    }
    </script>
</body>
</html>
